# Render Blueprint for Nutrition Platform
# Account: ieltspass111@gmail.com

services:
  # Static Site for Frontend
  - type: web
    name: nutrition-platform-frontend
    env: static
    buildCommand: |
      # No build needed for static files
      echo "Preparing static files..."
      ls -la frontend/public/
    staticPublishPath: ./frontend/public
    domains:
      - nutrition-platform.onrender.com
    envVars:
      - key: NODE_ENV
        value: production
    headers:
      - path: /*
        name: X-Frame-Options
        value: DENY
      - path: /*
        name: X-Content-Type-Options
        value: nosniff
      - path: /*
        name: Referrer-Policy
        value: strict-origin-when-cross-origin
      - path: /*
        name: Cache-Control
        value: public, max-age=31536000
      - path: /*.html
        name: Cache-Control
        value: public, max-age=0, must-revalidate
    routes:
      - type: rewrite
        source: /*
        destination: /index.html

  # Backend API Service (Optional - if needed)
  - type: web
    name: nutrition-platform-api
    env: go
    buildCommand: |
      cd backend
      go mod tidy
      go build -o main .
    startCommand: cd backend && ./main
    envVars:
      - key: PORT
        value: 10000
      - key: GO_ENV
        value: production
      - key: API_BASE_URL
        value: https://nutrition-platform-api.onrender.com
    healthCheckPath: /health
    disk:
      name: nutrition-data
      mountPath: /data
      sizeGB: 1

databases:
  # Optional: Add database if needed
  # - name: nutrition-db
  #   databaseName: nutrition_platform
  #   user: nutrition_user
  #   plan: free

envVarGroups:
  - name: nutrition-platform-config
    envVars:
      - key: APP_NAME
        value: "Nutrition Platform"
      - key: APP_VERSION
        value: "1.0.0"
      - key: FRONTEND_URL
        value: "https://nutrition-platform.onrender.com"
      - key: API_URL
        value: "https://nutrition-platform-api.onrender.com"