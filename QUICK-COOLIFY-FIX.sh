#!/bin/bash

echo "üöÄ QUICK COOLIFY DEPLOYMENT FIX"
echo "==============================="
echo ""
echo "üîç ISSUE DIAGNOSIS:"
echo "=================="
echo "‚úÖ Coolify Server: Running (128.140.111.171)"
echo "‚úÖ Traefik Proxy: Running"
echo "‚ùå Main API Service: running:unhealthy"
echo "‚ùå Test Service: exited:unhealthy"
echo ""
echo "üîß ROOT CAUSE:"
echo "============="
echo "‚Ä¢ Main API is configured as nginx:alpine (static server)"
echo "‚Ä¢ But Coolify expects a /health endpoint on port 8080"
echo "‚Ä¢ nginx:alpine doesn't provide health check endpoints"
echo "‚Ä¢ Test service has crashed completely"
echo ""
echo "üõ†Ô∏è  QUICK FIXES:"
echo "==============="
echo ""
echo "OPTION 1 - DISABLE HEALTH CHECK (RECOMMENDED)"
echo "============================================="
echo "If you want to run a static site:"
echo "1. Go to Coolify Dashboard"
echo "2. Navigate to: doctorhealthy1-api service"
echo "3. Click 'Edit' or 'Settings'"
echo "4. Find 'Health Check' section"
echo "5. Disable/Turn off health checks"
echo "6. Click 'Save' and redeploy"
echo ""
echo "OPTION 2 - FIX FOR GO APPLICATION"
echo "================================="
echo "If you want to run the Go backend:"
echo "1. Go to Coolify Dashboard"
echo "2. Edit doctorhealthy1-api service"
echo "3. Change 'Static Image' from 'nginx:alpine' to empty"
echo "4. Ensure 'Dockerfile' exists in your repository root"
echo "5. Set 'Base Directory' to '/'"
echo "6. Set 'Start Command' to './nutrition-platform' (Go binary)"
echo "7. Redeploy service"
echo ""
echo "OPTION 3 - RESTART TEST SERVICE"
echo "==============================="
echo "1. Go to Coolify Dashboard"
echo "2. Find the test service (dockerfile-*)"
echo "3. Click 'Restart' or 'Redeploy'"
echo ""
echo "üìã VERIFICATION:"
echo "==============="
echo "After fixes, run health check again:"
echo "‚Ä¢ Main API: https://my.doctorhealthy1.com"
echo "‚Ä¢ Test Service: http://vc40okgosockc8c8sgoko0k0.128.140.111.171.sslip.io"
echo ""
echo "üîç MONITORING:"
echo "============="
echo "Use the Coolify MCP server I created to monitor:"
echo "‚Ä¢ Check connection: coolify check_connection"
echo "‚Ä¢ View all services: coolify get_services"
echo "‚Ä¢ Health overview: coolify health_check"
echo ""
echo "üìû NEED HELP?"
echo "============="
echo "If issues persist, I can help you:"
echo "‚Ä¢ Fix the Dockerfile configuration"
echo "‚Ä¢ Implement proper health checks"
echo "‚Ä¢ Debug container logs"
echo "‚Ä¢ Set up proper monitoring"
echo ""
echo "‚úÖ SETUP COMPLETE"
echo "================"
echo "Your Coolify MCP server is ready to use!"
echo "Run: ./fix-coolify-healthcheck.sh for detailed instructions"

