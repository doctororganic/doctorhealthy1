http:
  middlewares:
    cors-headers:
      headers:
        accessControlAllowMethods:
          - "GET"
          - "OPTIONS"
          - "PUT"
          - "POST"
          - "DELETE"
        accessControlAllowOriginList:
          - "https://${DOMAIN:-localhost}"
          - "https://app.${DOMAIN:-localhost}"
          - "https://api.${DOMAIN:-localhost}"
        accessControlMaxAge: 100
        addVaryHeader: true
        accessControlAllowCredentials: true
        accessControlAllowHeaders:
          - "Authorization"
          - "Content-Type"
          - "X-Requested-With"
          - "X-API-Key"

    rate-limit-general:
      rateLimit:
        burst: 100
        average: 50
        period: "1m"

    rate-limit-api:
      rateLimit:
        burst: 50
        average: 25
        period: "1m"

    rate-limit-auth:
      rateLimit:
        burst: 10
        average: 5
        period: "1m"

    security-headers:
      headers:
        frameDeny: true
        sslRedirect: true
        browserXssFilter: true
        contentTypeNosniff: true
        forceSTSHeader: true
        stsIncludeSubdomains: true
        stsPreload: true
        stsSeconds: 31536000
        contentSecurityPolicy: "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:;"
        referrerPolicy: "strict-origin-when-cross-origin"
        permissionsPolicy: "geolocation=(), microphone=(), camera=()"
        customRequestHeaders:
          X-Forwarded-Proto: "https"
          X-Forwarded-Host: "${DOMAIN:-localhost}"
        customResponseHeaders:
          X-Robots-Tag: "noindex,nofollow,nosnippet,noarchive"
          Server: ""
          X-Powered-By: ""
          X-Frame-Options: "DENY"
          X-Content-Type-Options: "nosniff"
          X-XSS-Protection: "1; mode=block"

    compress:
      compress:
        excludedContentTypes:
          - "text/event-stream"
          - "application/grpc"

    health-check:
      headers:
        customRequestHeaders:
          X-Health-Check: "true"

    auth-basic:
      basicAuth:
        users:
          - "${TRAEFIK_DASHBOARD_USER:-admin}:$2y$10$${TRAEFIK_DASHBOARD_PASSWORD_HASH:-hashed_password_placeholder}"
        realm: "Traefik Dashboard"

    chain-frontend:
      chain:
        middlewares:
          - "cors-headers"
          - "rate-limit-general"
          - "security-headers"
          - "compress"

    chain-api:
      chain:
        middlewares:
          - "cors-headers"
          - "rate-limit-api"
          - "security-headers"
          - "compress"

    chain-monitoring:
      chain:
        middlewares:
          - "auth-basic"
          - "rate-limit-general"
          - "security-headers"
          - "compress"

tls:
  options:
    default:
      minVersion: "VersionTLS13"
      cipherSuites:
        - "TLS_AES_256_GCM_SHA384"
        - "TLS_AES_128_GCM_SHA256"
        - "TLS_CHACHA20_POLY1305_SHA256"
      sniStrict: true
      clientAuth:
        caFiles:
          - "/etc/ssl/certs/ca-certificates.crt"
        clientAuthType: "NoClientCert"

  certificates:
    - certFile: "/etc/ssl/certs/${DOMAIN:-localhost}.crt"
      keyFile: "/etc/ssl/private/${DOMAIN:-localhost}.key"
    - certFile: "/etc/ssl/certs/api.${DOMAIN:-localhost}.crt"
      keyFile: "/etc/ssl/private/api.${DOMAIN:-localhost}.key"
